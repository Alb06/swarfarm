{% load staticfiles %}
{% load utils %}
{% static 'herders/images/' as img_url_prefix %}

<div class="panel panel-default">
    <div class="panel-heading">
        <span class="panel-title"><strong><img src="{{ img_url_prefix }}elements/{{ monster.element }}.png" style="height:1em"/> {{ monster.name }}</strong> - <small>{{ monster.get_archetype_display }}</small></span>
        {% if request.user.is_superuser %}
            <a href="{% url 'admin:bestiary_monster_change' object_id=monster.pk %}" class="btn btn-xs edit-skill pull-right" target="_blank"><span class="glyphicon glyphicon-pencil"></span></a>
        {% endif %}
    </div>
    <div class="panel-body">
        <div class="monster-box">
            {% include 'bestiary/monster/portrait_large.html' with monster=monster only %}

            {% if monster.obtainable %}
            <div class="monster-box-actions">
                <button class="btn btn-link btn-xs monster-add" data-monster="{{ monster.pk }}" data-stars="{{ monster.stars }}">
                    <span class="glyphicon glyphicon-plus"></span> Collection
                </button>
            </div>
            {% endif %}
        </div>

        <div class="panel panel-default monster-info-panel">
            <table class="table table-condensed table-bordered">
                <tbody>
                {% if monster.transforms_into %}
                    <tr>
                        <td>Transforms Into</td>
                        <td><a href="{% url 'bestiary:detail' monster_slug=monster.transforms_into.bestiary_slug  %}"><img class="monster-thumb" src="{{ img_url_prefix }}monsters/{{ monster.transforms_into.image_filename }}" /> {{ monster.transforms_into }}</a></td>
                    </tr>
                {% endif %}
                <tr>
                    <td>Awakening Bonus:</td>
                    <td>{{ monster.awaken_bonus }}</td>
                </tr>
                {% with sources=monster.source.all %}
                {% if sources|length %}
                <tr>
                    <td>Sources:</td>
                    <td class="monster-sources">
                        {% for source in sources %}
                            {% if source.icon_filename %}
                            <img src="{{ img_url_prefix }}icons/{{ source.icon_filename }}"
                                 class="monster-source" data-toggle="tooltip" data-placement="top" data-container="body" title="{{ source.name }}" />
                            {% else %}
                            <span class="monster-source"><span>{{ source }}</span></span>
                            {% endif %}
                        {% endfor %}
                    </td>
                </tr>
                {% endif %}
                {% endwith %}
                {% if monster.can_awaken and not monster.is_awakened %}
                <tr>
                    <td>Awakening Essences:</td>
                    <td class="monster-awaken-materials">
                        {% include 'bestiary/awakening_essences.html' %}
                    </td>
                </tr>
                {% endif %}
                {% with fusion_set=monster.fusion_set.all %}
                    {% if fusion_set|length %}
                        <tr>
                            <td>Fusion Ingredient For:</td>
                            <td class="monster-awaken-materials">
                                {% for fusion in fusion_set %}
                                <div class="monster-image">
                                    <img src="{{ img_url_prefix }}monsters/{{ fusion.product.image_filename }}" class="monster-thumb"/>
                                    <span>
                                        {% for x in fusion.product.base_stars|get_range %}
                                            {% if fusion.product.is_awakened %}
                                                <img src="{{ img_url_prefix }}stars/star-awakened.png" class="monster-star monster-star-{{ forloop.counter }}" />
                                            {% elif fusion.product.can_awaken %}
                                                <img src="{{ img_url_prefix }}stars/star-unawakened.png" class="monster-star monster-star-{{ forloop.counter }}" />
                                            {% else %}
                                                <img src="{{ img_url_prefix }}stars/star-fodder.png" class="monster-star monster-star-{{ forloop.counter }}" />
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                </div>
                                {% endfor %}
                            </td>
                        </tr>
                    {% endif %}
                {% endwith %}

                {% if monster.skill_ups_to_max %}
                <tr>
                    <td>Skill-ups to Max</td>
                    <td class="monster-awaken-materials">
                        <div class="monster-image">
                            <img src="{{ img_url_prefix }}monsters/devilmon_dark.png" class="monster-thumb"/>
                            <span class="image-plus image-plus-main">{{ monster.skill_ups_to_max }}</span>
                        </div>
                    </td>
                </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>