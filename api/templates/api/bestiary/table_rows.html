{% load staticfiles %}
{% load utils %}
{% static 'herders/images/' as img_url_prefix %}

{% for monster in data %}
<tr>
    <td class="monster-image">
        <div>
            <a href="{% url 'herders:bestiary_detail' monster_id=monster.pk %}">
                <img src="{{ img_url_prefix }}monsters/{{ monster.image_filename }}" class="monster-thumb"/>
                <span>
                    {% for x in monster.base_stars|get_range %}
                        {% if monster.is_awakened %}
                            <img src="{{ img_url_prefix }}stars/star-awakened.png" class="monster-star monster-star-{{ forloop.counter }}" />
                        {% elif monster.can_awaken %}
                            <img src="{{ img_url_prefix }}stars/star-unawakened.png" class="monster-star monster-star-{{ forloop.counter }}" />
                        {% else %}
                            <img src="{{ img_url_prefix }}stars/star-fodder.png" class="monster-star monster-star-{{ forloop.counter }}" />
                        {% endif %}
                    {% endfor %}
                </span>
            </a>
        </div>
    </td>
    <td class="monster-name">{{ monster.name|title }}</td>
    <td class="monster-stars-column">{{ monster.base_stars }}<span class="glyphicon glyphicon-star"></span></td>
    <td class="monster-element">
        <img src="{{ img_url_prefix }}elements/{{ monster.element }}.png" />
        <span>{{ monster.element }}</span>
    </td>
    <td class="monster-type">{{ monster.archetype|title }}</td>
    <td class="monster-awakens">
        {% if monster.awakens_to %}
            <a href="{% url 'herders:bestiary_detail' monster_id=monster.awakens_to.pk %}">
                <img src="{{ img_url_prefix }}monsters/{{ monster.awakens_to.image_filename }}" />
                {{ monster.awakens_to.name|title }}
            </a>
        {% endif %}
    </td>
    <td class="monster-awakens">
        {% if monster.awakens_from %}
            <a href="{% url 'herders:bestiary_detail' monster_id=monster.awakens_from.pk %}">
                <img src="{{ img_url_prefix }}monsters/{{ monster.awakens_from.image_filename }}" />
                {{ monster.awakens_from.name|title }}
            </a>
        {% endif %}
    </td>
    <td class="monster-skill-effects">
        {% for effect in monster.all_skill_effects %}
            {% if effect.icon_filename %}
                <img src="{{ img_url_prefix }}/buffs/{{ effect.icon_filename }}"
                        data-toggle="popover" data-trigger="hover" data-placement="top" data-container="body" title="{{ effect.name }}" data-content="{{ effect.description }}"/>
            {% else %}
                <span class="skill-effect {% if effect.is_buff %}skill-effect-buff{% else %}skill-effect-debuff{% endif %}" data-toggle="popover" data-trigger="hover" data-placement="top" data-container="body" title="{{ effect.name }}" data-content="{{ effect.description }}">
                    <span>{{ effect.name }}</span>
                </span>
            {% endif %}
            <span class="hidden">{{ effect.pk }}-{{ effect.name|slugify }}</span>
        {% endfor %}
    </td>
    <td class="monster-awaken-materials">
        {% with mats=monster.get_awakening_materials %}
            {% for element,essences in mats.iteritems %}
                {% for size,count in essences.iteritems %}
                    {% include 'herders/essence_fragment.html' with element=element size=size count=count only %}
                {% endfor %}
            {% endfor %}
        {% endwith %}
    </td>
</tr>
{% endfor %}