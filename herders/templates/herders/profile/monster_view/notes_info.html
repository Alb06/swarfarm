{% load staticfiles %}
{% load utils %}
{% load markdown_deux_tags %}
{% static 'herders/images/' as img_url_prefix %}

{% if instance.notes and instance.notes != '' %}
<div class="panel panel-default">
    <div class="panel-heading">
        <p class="panel-title">Personal Notes</p>
    </div>
    <div class="panel-body">
        {{ instance.notes|markdown }}
    </div>
</div>
{% endif %}
<div class="panel panel-default">
    <div class="panel-heading">
        <p class="panel-title">Monster Info</p>
    </div>
    <table class="table table-condensed table-bordered">
        <tbody>
        {% if instance.monster.can_awaken and not instance.monster.is_awakened %}
            {% with instance.monster.awakens_to as awakened %}
            <tr>
                <td>Awakens To:</td>
                <td>
                    <span class="monster-image">
                        <a href="{% url 'herders:bestiary_detail' monster_slug=awakened.bestiary_slug %}" target="_blank">
                            <img src="{{ img_url_prefix }}monsters/{{ awakened.image_filename }}" class="monster-thumb"/>
                            <span>
                                {% for x in awakened.base_stars|get_range %}
                                    <img src="{{ img_url_prefix }}stars/star-awakened.png" class="monster-star monster-star-{{ forloop.counter }}" />
                                {% endfor %}
                            </span>
                        </a>
                    </span>
                    Bonus: {{ instance.monster.awaken_bonus }}
                </td>
            </tr>
            {% endwith %}
        {% endif %}
        {% if instance.monster.can_awaken and not instance.monster.is_awakened %}
        <tr>
            <td>Awakening Essences:</td>
            <td class="monster-awaken-materials">
                {% with mats=instance.monster.get_awakening_materials %}
                    {% for element,essences in mats.iteritems %}
                        {% for size,count in essences.iteritems %}
                            {% include 'herders/essence_fragment.html' with element=element size=size count=count only %}
                        {% endfor %}
                    {% endfor %}
                {% endwith %}
            </td>
        </tr>
        {% endif %}
        <tr>
            <td>Sources:</td>
            <td class="monster-sources">
                {% for source in instance.monster.source.all %}
                    {% if source.icon_filename %}
                    <img src="{{ img_url_prefix }}icons/{{ source.icon_filename }}"
                         class="monster-source" data-toggle="tooltip" data-placement="top" data-container="body" title="{{ source.name }}" />
                    {% else %}
                    <span class="monster-source"><span>{{ source }}</span></span>
                    {% endif %}
                {% endfor %}
            </td>
        </tr>
        <tr>
            <td>Resources:</td>
            <td>
                <ul class="list-unstyled">
                    <li><a href="{% url 'herders:bestiary_detail' monster_slug=instance.monster.bestiary_slug %}"><span class="glyphicon glyphicon-link"></span> SWARFARM Bestiary</a></li>
                    <li>{% if instance.monster.wikia_url %}<a href="{{ instance.monster.wikia_url }}" target="_blank"><span class="glyphicon glyphicon-link"></span> Wikia</a>{% endif %}</li>
                    <li>{% if instance.monster.summonerswar_co_url %}<a href="{{ instance.monster.summonerswar_co_url }}" target="_blank"><span class="glyphicon glyphicon-link"></span> summonerswar.co</a>{% endif %}</li>
                </ul>
            </td>
        </tr>
    </table>
</div>